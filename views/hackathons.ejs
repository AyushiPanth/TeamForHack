<%- include('partials/header'); -%>
<!-- <%- include('sidenav'); -%> -->
<div id="content" class="hackathon-cont">
    <p hidden class="userid"><%= user._id %></p>
    <div class="hackathon-left" style="direction: rtl;">
        <div style="width: 300px;display: flex;
        flex-direction: column;align-items: center; position: fixed;
        background-color: #fafafa; direction: ltr;" >
            <div style="width: 100%;" >
                <a href="/user/dashboard" class="ml-2 mt-2 back-crcle">
                   <i class="fa fa-chevron-left" aria-hidden="true"></i>
                </a>
            </div> 
           <h2 class="mb-1 text-center pt-3"> Hackathons</h2>
           <span class="underline mb-4" style="width: 40%;" ></span>
        </div>

        <div class="text-center hacks">
            <% hacksCurrent.forEach((hackathon , i) => { %>
                <% if(i == 0){ %>
                <p id="<%= hackathon.id %>" class="hacknames activeHack" style="color:black" onclick="renderData(this)"><%= hackathon.title %></p>
                <% }else{ %>
                <p id="<%= hackathon.id %>" class="hacknames" style="color:black" onclick="renderData(this)"><%= hackathon.title %></p>
                <%}%>    
            <% }) %>
            <% hacksFinished.forEach((hackathon) => { %>
                <p id ="<%= hackathon.id %>"  class="hacknames" onclick="renderData(this)"><%= hackathon.title %></p>
            <% }) %>
        </div>
    </div>
    <div class="hackathon-right">
        <% hacksCurrent.forEach((hackathon , i) => { %>
            <% if(i == 0){%>
                <section class="<%=hackathon.id %> hackSections hackSectionsDisplay" >
                <%}else{%>
            <section class="<%=hackathon.id %> hackSections">
                <%}%>
                <p> <%= hackathon.title %>
                <input type="checkbox" id="<%=hackathon.id %>" onclick="takePart(this)"> Want users to search you? 
                </p>
                <% hackathon.participants.forEach((user) => { %>
                    <p ><%= user.name %></p>
                <% }) %>
            </section>
        <% }) %>
    </div>
    </div>
</div>



<%- include('partials/footer'); -%>
<script>
    
    function takePart(e){
        console.log(document.querySelector('.userid').textContent.trim());
        const uri = "http://localhost:3000/user/hackathons/insert/"+ e.id +"/"+document.querySelector('.userid').textContent.trim();
        console.log(uri);
        if(e.checked){
            fetch(uri, {
                method: 'POST'
            })
        }
        else {
            fetch(uri, {
                method: 'DELETE'
            })
        }
    }
    function renderData(e){
        let prev = document.getElementsByClassName("hacknames activeHack");
        if(prev.length >0){
            prev[0].classList.remove('activeHack');
        }
        e.className += " activeHack"; 
        let newprev = document.getElementsByClassName("hackSections hackSectionsDisplay");
        if(newprev.length >0){
            newprev[0].classList.remove('hackSectionsDisplay');
        }

        let sec = document.getElementsByClassName(`${e.id} hackSections`);
        sec[0].className+=" hackSectionsDisplay";
    }
    var hl = document.querySelector("hackathon-left");
</script>